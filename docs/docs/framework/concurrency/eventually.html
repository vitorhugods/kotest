<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-177425497-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Eventually | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/framework/concurrency/eventually.html"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Eventually | Kotest"><meta data-react-helmet="true" name="description" content="Starting with Kotest 4.6, a new experimental module has been added which contains improved"><meta data-react-helmet="true" property="og:description" content="Starting with Kotest 4.6, a new experimental module has been added which contains improved"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/framework/concurrency/eventually.html"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/framework/concurrency/eventually.html" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/framework/concurrency/eventually.html" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ba064302.css">
<link rel="preload" href="/assets/js/runtime~main.0f6b8ab1.js" as="script">
<link rel="preload" href="/assets/js/main.cab5088f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Kotest</b></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/writing-tests.html">Writing Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/testing-styles.html">Testing Styles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Conditional Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/isolation-mode.html">Isolation Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/lifecycle-hooks.html">Lifecycle hooks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Extensions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Coroutines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/exceptions.html">Exceptions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Data Driven Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Non-deterministic Testing</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/framework/concurrency/eventually.html">Eventually</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/continually.html">Continually</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/until.html">Until</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/retry.html">Retry</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integrations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Ordering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/tags.html">Grouping Tests</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/test-factories.html">Test Factories</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework/test_output.html">Test Output</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Timeouts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Other settings</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Eventually</h1></header><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>New improved module</h5></div><div class="admonition-content"><p>Starting with Kotest 4.6, a new experimental module has been added which contains improved
utilities for testing concurrent, asynchronous, or non-deterministic code. This module
is <code>kotest-framework-concurrency</code> and is intended as a long term replacement for the previous module. The previous
utilities are still available as part of the core framework.</p></div></div><p>Testing non-deterministic code can be hard. You might need to juggle threads, timeouts, race conditions, and the
unpredictability of when events are happening.</p><p>For example, if you were testing that an asynchronous file write was completed successfully, you need to wait until the
write operation has completed and flushed to disk.</p><p>Some common approaches to these problems are:</p><ul><li><p>Using callbacks which are invoked once the operation has completed. The callback can be then used to assert that the
state of the system is as we expect. But not all operations provide callback functionality.</p></li><li><p>Block the thread using <code>Thread.sleep</code> or suspend a function using <code>delay</code>, waiting for the operation to complete.
The sleep threshold needs to be set high enough to be sure the operations will have completed on a fast or slow machine, and
even when complete, the thread will stay blocked until the timeout has expired.</p></li><li><p>Use a loop with a sleep and retry and a sleep and retry, but then you need to write boilerplate to track number of
iterations, handle certain exceptions and fail on others, ensure the total time taken has not exceeded the max and so
on.</p></li><li><p>Use countdown latches and block threads until the latches are released by the non-determistic operation. This can
work well if you are able to inject the latches in the appropriate places, but just like callbacks, it isn&#x27;t always
possible to have the code to be tested integrate with a latch.</p></li></ul><p>As an alternative to the above solutions, kotest provides the <code>eventually</code> utility which solves the common use case of
<em>&quot;<strong>I expect this code to pass after a short period of time</strong>&quot;</em>.</p><p>Eventually does this by periodically invoking a given lambda until the timeout is eventually reached or too many iterations have passed. This is
flexible and is perfect for testing nondeterministic code. Eventually can be customized in regardless to the types of
exceptions to handle, how the lambda is considered a success or failure, with a listener, and so on.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="api">API<a aria-hidden="true" class="hash-link" href="#api" title="Direct link to heading">â€‹</a></h2><p>There are two ways to use eventually. The first is simply providing a duration in either milliseconds
(or using the Kotlin <code>Duration</code> type) followed by the code that should eventually pass without an exception being raised.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually(5000) { // duration in millis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The second is by providing a configuration block before the test code. This method should be used when you need to
set more options than just the duration.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interval = 1000.fixed()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="configuration">Configuration<a aria-hidden="true" class="hash-link" href="#configuration" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="durations-and-intervals">Durations and Intervals<a aria-hidden="true" class="hash-link" href="#durations-and-intervals" title="Direct link to heading">â€‹</a></h3><p>The duration is the total amount of time to keep trying to pass the test. The <code>interval</code> however allows us to
specify how often the test should be attempted. So if we set duration to 5 seconds, and interval to 250 millis,
then the test would be attempted at most <code>5000 / 250 = 20</code> times.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="initial-delay">Initial Delay<a aria-hidden="true" class="hash-link" href="#initial-delay" title="Direct link to heading">â€‹</a></h3><p>Usually <code>eventually</code> starts executing the test block immediately, but we can add an initial delay before the first
iteration using <code>initialDelay</code>, such as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initialDelay = 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="retries">Retries<a aria-hidden="true" class="hash-link" href="#retries" title="Direct link to heading">â€‹</a></h3><p>In addition to bounding the number of invocations by time, we can do so by iteration count. In the following example
we retry the operation 10 times, or until 8 seconds has expired.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retries = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  suppressExceptions = setOf(UserNotFoundException::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldNotBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="specifying-the-exceptions-to-trap">Specifying the exceptions to trap<a aria-hidden="true" class="hash-link" href="#specifying-the-exceptions-to-trap" title="Direct link to heading">â€‹</a></h3><p>By default, <code>eventually</code> will ignore any <code>AssertionError</code> that is thrown inside the function (note, that means it won&#x27;t
catch <code>Error</code>). If you want to be more specific, you can tell <code>eventually</code> to ignore specific exceptions and any others
will immediately fail the test.</p><p>For example, when testing that a user should exist in the database, a <code>UserNotFoundException</code> might be thrown
if the user does not exist. We know that eventually that user will exist. But if an <code>IOException</code> is thrown, we don&#x27;t
want to keep retrying as this indicates a larger issue than simply timing.</p><p>We can do this by specifying that <code>UserNotFoundException</code> is an exception to suppress.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  suppressExceptions = setOf(UserNotFoundException::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldNotBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As an alternative to passing in a set of exceptions, we can provide a function which is invoked, passing in the throw
exception. This function should return true if the exception should be handled, or false if the exception should bubble out.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  suppressExceptionIf = { it is UserNotFoundException &amp;&amp; it.username == &quot;bob&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userRepository.getById(1).name shouldNotBe &quot;bob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="predicates">Predicates<a aria-hidden="true" class="hash-link" href="#predicates" title="Direct link to heading">â€‹</a></h3><p>In addition to verifying a test case eventually runs without throwing an exception, we can also verify that the
return value of the test is as expected - and if not, consider that iteration a failure and try again.</p><p>For example, here we continue to append &quot;x&quot; to a string until the result of the previous iteration is equal to &quot;xxx&quot;.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">var string = &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 5.seconds()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  predicate = { it.result == &quot;xxx&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string += &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="listeners">Listeners<a aria-hidden="true" class="hash-link" href="#listeners" title="Direct link to heading">â€‹</a></h3><p>We can attach a listener, which will be invoked on each iteration, with the state of that iteration. The state object
contains the last exception, last value, iteration count and so on.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">eventually({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 5.seconds()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listener = { println(&quot;iteration ${it.times} returned ${it.result}&quot;) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string += &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="sharing-configuration">Sharing configuration<a aria-hidden="true" class="hash-link" href="#sharing-configuration" title="Direct link to heading">â€‹</a></h3><p>Sharing the configuration for eventually is a breeze with the <code>EventuallyConfig</code> data class. Suppose you have classified the
operations in your system to &quot;slow&quot; and &quot;fast&quot; operations. Instead of remembering which timing values were for slow and
fast we can set up some objects to share between tests and customize them per suite. This is also a perfect time to show
off the listener capabilities of <code>eventually</code> which give you insight into the current value of the result of your
producer and the state of iterations!</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val slow = EventuallyConfig&lt;ServerResponse&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  duration = 5.minutes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interval = 25.milliseconds.fibonacci(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  suppressExceptions = setOf(ServerException::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FooTests : StringSpec({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val logger = logger(&quot;FooTests&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val fSlow = slow.copy(listener = { i, t -&gt; logger.info(&quot;Current $i after {${t.times} attempts&quot;) })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;server eventually provides a result for /foo&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventually(fSlow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fooApi()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BarTests : StringSpec({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val logger = logger(&quot;BarTests&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val bFast = fast.copy(listener = { i, t -&gt; logger.info(&quot;Current $i after {${t.times} attempts&quot;) })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;server eventually provides a result for /bar&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eventually(bFast) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      barApi()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here we can see sharing of configuration can be useful to reduce duplicate code while allowing flexibility for things
like custom logging per test suite for clear test logs.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/framework/concurrency/eventually.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/framework/datatesting/nested-tests.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Nested Data Tests</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/assertions/continually.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Continually<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#api" class="table-of-contents__link toc-highlight">API</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#durations-and-intervals" class="table-of-contents__link toc-highlight">Durations and Intervals</a></li><li><a href="#initial-delay" class="table-of-contents__link toc-highlight">Initial Delay</a></li><li><a href="#retries" class="table-of-contents__link toc-highlight">Retries</a></li><li><a href="#specifying-the-exceptions-to-trap" class="table-of-contents__link toc-highlight">Specifying the exceptions to trap</a></li><li><a href="#predicates" class="table-of-contents__link toc-highlight">Predicates</a></li><li><a href="#listeners" class="table-of-contents__link toc-highlight">Listeners</a></li><li><a href="#sharing-configuration" class="table-of-contents__link toc-highlight">Sharing configuration</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Kotest Team. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0f6b8ab1.js"></script>
<script src="/assets/js/main.cab5088f.js"></script>
</body>
</html>