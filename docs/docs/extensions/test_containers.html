<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-177425497-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Test Containers | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/extensions/test_containers.html"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Test Containers | Kotest"><meta data-react-helmet="true" name="description" content="Test Containers"><meta data-react-helmet="true" property="og:description" content="Test Containers"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/extensions/test_containers.html"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/extensions/test_containers.html" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/extensions/test_containers.html" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ba064302.css">
<link rel="preload" href="/assets/js/runtime~main.0f6b8ab1.js" as="script">
<link rel="preload" href="/assets/js/main.cab5088f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Kotest</b></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/extensions.html">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/spring.html">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/ktor.html">Ktor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/system_extensions.html">System Extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/extensions/test_containers.html">Test Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/embedded-kafka.html">Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/mockserver.html">MockServer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/junit_xml.html">JUnit XML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/html_reporter.html">HTML Reporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/allure.html">Allure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/instant.html">Current Instant Listeners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/koin.html">Koin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/wiremock.html">WireMock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/robolectric.html">Robolectric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/extensions/pitest.html">Pitest</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Test Containers</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="test-containers">Test Containers<a aria-hidden="true" class="hash-link" href="#test-containers" title="Direct link to heading">â€‹</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This documentation is for the latest release of the test containers module and is compatible with Kotest 5.0+.
For earlier versions see docs <a href="https://kotest.io/docs/extensions/test_containers_46.html" target="_blank" rel="noopener noreferrer">here</a></p></div></div><p>The <a href="https://github.com/testcontainers/testcontainers-java" target="_blank" rel="noopener noreferrer">testcontainers</a> project provides lightweight, ephemeral instances of common databases,
elasticsearch, kafka, Selenium web browsers, or anything else that can run in a Docker container - ideal for use inside tests.</p><p>Kotest provides integration with testcontainers through an additional module which provides several extensions - specialized extensions for
databases and kafka and general containers support for any supported docker image.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="dependencies">Dependencies<a aria-hidden="true" class="hash-link" href="#dependencies" title="Direct link to heading">â€‹</a></h3><p>To begin, add the following dependency to your Gradle build file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">io.kotest.extensions:kotest-extensions-testcontainers:${kotest.version}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="https://search.maven.org/artifact/io.kotest.extensions/kotest-extensions-testcontainers" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/maven-central/v/io.kotest.extensions/kotest-extensions-testcontainers.svg?label=latest%20release"></a>
<a href="https://oss.sonatype.org/content/repositories/snapshots/io/kotest/extensions/kotest-extensions-testcontainers/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nexus/s/https/oss.sonatype.org/io.kotest.extensions/kotest-extensions-testcontainers.svg?label=latest%20snapshot"></a></p><p>Note: The group id is different (<code>io.kotest.extensions</code>) from the main kotest dependencies (<code>io.kotest</code>).</p><p>For Maven, you will need these dependencies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.kotest.extensions</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">kotest-extensions-testcontainers</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${kotest.version}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="databases">Databases<a aria-hidden="true" class="hash-link" href="#databases" title="Direct link to heading">â€‹</a></h3><p>For JDBC compatible databases, Kotest provides the <code>JdbcTestContainerExtension</code>. This provides a pooled <code>javax.sql.DataSource</code>, backed by
an instance of <a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener noreferrer">HikariCP</a>, which can be configured during setup.</p><p>Firstly, create the container.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val mysql = MySQLContainer&lt;Nothing&gt;(&quot;mysql:8.0.26&quot;).apply {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  startupAttempts = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withUrlParam(&quot;connectionTimeZone&quot;, &quot;Z&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withUrlParam(&quot;zeroDateTimeBehavior&quot;, &quot;convertToNull&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Secondly, install the container inside an extension wrapper, providing an optional configuration lambda.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val ds = install(JdbcTestContainerExtension(mysql)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  poolName = &quot;myconnectionpool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maximumPoolSize = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  idleTimeout = 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you don&#x27;t wish to configure the pool, then you can omit the trailing lambda.</p><p>Then the datasource can be used in a test. For example, here is a full example of inserting some
objects and then retrieving them to test that the insert was successful.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class QueryDatastoreTest : FunSpec({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val mysql = MySQLContainer&lt;Nothing&gt;(&quot;mysql:8.0.26&quot;).apply {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    startupAttempts = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    withUrlParam(&quot;connectionTimeZone&quot;, &quot;Z&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    withUrlParam(&quot;zeroDateTimeBehavior&quot;, &quot;convertToNull&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val ds = install(JdbcTestContainerExtension(mysql)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    poolName = &quot;myconnectionpool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maximumPoolSize = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    idleTimeout = 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val datastore = PersonDatastore(ds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test(&quot;insert happy path&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datastore.insert(Person(&quot;sam&quot;, &quot;Chicago&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datastore.insert(Person(&quot;jim&quot;, &quot;Seattle&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datastore.findAll().shouldBe(listOf(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Person(&quot;sam&quot;, &quot;Chicago&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Person(&quot;jim&quot;, &quot;Seattle&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>This extension also supports the <code>LifecycleMode</code> flag to control when the container is started and stopped.
See #lifecycle</p></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="initializing-the-database-container">Initializing the Database Container<a aria-hidden="true" class="hash-link" href="#initializing-the-database-container" title="Direct link to heading">â€‹</a></h4><p>There are two ways to initialize the database container: via a <em>single</em> init script added to the TestContainer config,
or via a list of scripts added to the JdbcTestContainerExtension config lambda.</p><p>If adding a <em><strong>single</strong></em> script, via the TestContainer config, simply add the script to the TestContainer&#x27;s <code>withInitScript</code> config option, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val mysql = MySQLContainer&lt;Nothing&gt;(&quot;mysql:8.0.26&quot;).apply {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         withInitScript(&quot;init.sql&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         startupAttempts = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         withUrlParam(&quot;connectionTimeZone&quot;, &quot;Z&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         withUrlParam(&quot;zeroDateTimeBehavior&quot;, &quot;convertToNull&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you have multiple init scripts or sets of changesets, you can add them as a list to the <code>dbInitScripts</code> extension config lambda, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val ds = install(JdbcTestContainerExtension(mysql, LifecycleMode.Leaf)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      maximumPoolSize = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      minimumIdle = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dbInitScripts = listOf(&quot;/init.sql&quot;, &quot;/sql-changesets&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The list can contain absolute or relative paths, for files and folders on the filesystem or on the classpath.</p><p>The extension will process the list provided in order. If the list item is a folder, it will process all <code>.sql</code> scripts in the folder,
sorted lexicographically. These scripts run every time the container is started, so it supports the <code>LifecycleMode</code> flag.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="general-containers">General Containers<a aria-hidden="true" class="hash-link" href="#general-containers" title="Direct link to heading">â€‹</a></h3><p>Similar to the <code>JdbcTestContainerExtension</code>, this module also provides a <code>TestContainerExtension</code> extension which can
wrap any container, not just databases.</p><p>We can create the extension using either a docker image name, or a strongly typed container.</p><p>For example, using a docker image directly:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val container = install(TestContainerExtension(&quot;redis:5.0.3-alpine&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  startupAttempts = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withExposedPorts(6379)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And then using a strongly typed container:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val elasticsearch = install(TestContainerExtension(ElasticsearchContainer(ELASTICSEARCH_IMAGE) )) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withPassword(ELASTICSEARCH_PASSWORD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The strongly typed container is preferred when one is provided by the test containers project, because it gives us
access to specific settings - such as the password option in the elasticsearch example above.</p><p>However, when a strongly typed container is not available, the former method allows us to spool up any docker image
as a general container.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>This extension also supports the <code>LifecycleMode</code> flag to control when the container is started and stopped.
See #lifecycle</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="kafka-containers">Kafka Containers<a aria-hidden="true" class="hash-link" href="#kafka-containers" title="Direct link to heading">â€‹</a></h3><p>For Kafka, this module provides convenient extension methods to create a consumer, producer or admin client from the container.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val kafka = install(TestContainerExtension(KafkaContainer(DockerImageName.parse(&quot;confluentinc/cp-kafka:6.2.1&quot;)))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withEmbeddedZookeeper()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Inside the configuration lambda, we can specify options for the Kafka container, such as embedded/external zookeeper,
or kafka broker properties through env vars. For example, to enable dynamic topic creation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val kafka = install(TestContainerExtension(KafkaContainer(DockerImageName.parse(&quot;confluentinc/cp-kafka:6.2.1&quot;)))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  withEnv(&quot;KAFKA_AUTO_CREATE_TOPICS_ENABLE&quot;, &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Note for Apple Silicon/ARM Users</h5></div><div class="admonition-content"><p>Kafka only publishes a <code>linux/amd64</code> version of the container. If you&#x27;re on an Apple Silicon/ARM architecture computer,
you&#x27;ll need to explicitly specify the platform with the following added to the configuration lambda outlined above:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">withCreateContainerCmdModifier { it.withPlatform(&quot;linux/amd64&quot;) }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><p>Once we have the container installed, we can create a client using the following methods:</p><ul><li>container.createProducer()</li><li>container.createStringStringProducer()</li><li>container.createConsumer()</li><li>container.createStringStringConsumer()</li><li>container.createAdminClient()</li></ul><p>Each of these accepts an optional configuration lambda to enable setting values on the properties object that is
used to create the clients.</p><p>For example, in this test, we produce and consume a message from the same topic, and we use the configuration
lambda to set max poll to 1.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">class KafkaTestContainerExtensionTest : FunSpec() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  init {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val kafka = install(TestContainerExtension(KafkaContainer(DockerImageName.parse(&quot;confluentinc/cp-kafka:6.2.1&quot;)))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      withEmbeddedZookeeper()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test(&quot;should send/receive message&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val producer = kafka.createStringStringProducer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      producer.send(ProducerRecord(&quot;foo&quot;, null, &quot;bubble bobble&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      producer.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val consumer = kafka.createStringStringConsumer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this[ConsumerConfig.MAX_POLL_RECORDS_CONFIG] = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      consumer.subscribe(listOf(&quot;foo&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val records = consumer.poll(Duration.ofSeconds(100))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      records.shouldHaveSize(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>When creating a consumer, the consumer group is set to a random uuid. To change this, provide
a configuration lambda and specify your own group consumer group id.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="lifecycle">Lifecycle<a aria-hidden="true" class="hash-link" href="#lifecycle" title="Direct link to heading">â€‹</a></h3><p>By default, the lifecycle of a container is per spec - so it will be started at the <code>install</code> command, and shutdown as
the spec is completed. This can be changed to start/stop per test, per leaf test, or per root test.</p><p>To do this, pass in a <code>LifecycleMode</code> parameter to the <code>TestContainerExtension</code> or <code>JdbcTestContainerExtension</code>.</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">val ds = install(JdbcTestContainerExtension(mysql, LifecycleMode.Root)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  poolName = &quot;myconnectionpool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maximumPoolSize = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  idleTimeout = 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you change the lifecycle mode from Spec then the container will not be started in the constructor, and so
any operations that act on the container must be placed inside the test scopes.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="startables">Startables<a aria-hidden="true" class="hash-link" href="#startables" title="Direct link to heading">â€‹</a></h3><p>This module also provides extension methodsscope which let you convert
any <code>Startable</code> such as a <code>DockerContainer</code> into a kotest <code>TestListener</code>, which you can register with Kotest
and then Kotest will manage the lifecycle of that container for you.</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">import io.kotest.core.spec.style.FunSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.kotest.extensions.testcontainers.perTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.testcontainers.containers.GenericContainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DatabaseRepositoryTest : FunSpec({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   val redisContainer = GenericContainer&lt;Nothing&gt;(&quot;redis:5.0.3-alpine&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   listener(redisContainer.perTest()) //converts container to listener and registering it with Kotest.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   test(&quot;some test which assume to have redis container running&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In above example, the <code>perTest()</code> extension method converts the container into a <code>TestListener</code>, which starts the
redis container before each test and stops it after test. Similarly if you want to reuse the container for all tests
in a single spec class you can use <code>perSpec()</code> extension method, which converts the container into a <code>TestListener</code>
which starts the container before running any test in the spec, and stops it after all tests, thus a single container is
used by all tests in spec class.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/extensions/test_containers.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/extensions/system_extensions.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->System Extensions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extensions/embedded-kafka.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kafka<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#test-containers" class="table-of-contents__link toc-highlight">Test Containers</a><ul><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li><li><a href="#databases" class="table-of-contents__link toc-highlight">Databases</a></li><li><a href="#general-containers" class="table-of-contents__link toc-highlight">General Containers</a></li><li><a href="#kafka-containers" class="table-of-contents__link toc-highlight">Kafka Containers</a></li><li><a href="#lifecycle" class="table-of-contents__link toc-highlight">Lifecycle</a></li><li><a href="#startables" class="table-of-contents__link toc-highlight">Startables</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Kotest Team. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0f6b8ab1.js"></script>
<script src="/assets/js/main.cab5088f.js"></script>
</body>
</html>