<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-177425497-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Shrinking | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/proptest/property-test-shrinking.html"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Shrinking | Kotest"><meta data-react-helmet="true" name="description" content="In property-based testing, the initially found failing case may contain a lot of complexity that does actually cause the test to fail."><meta data-react-helmet="true" property="og:description" content="In property-based testing, the initially found failing case may contain a lot of complexity that does actually cause the test to fail."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/proptest/property-test-shrinking.html"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/proptest/property-test-shrinking.html" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kotest.io/docs/proptest/property-test-shrinking.html" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ba064302.css">
<link rel="preload" href="/assets/js/runtime~main.0f6b8ab1.js" as="script">
<link rel="preload" href="/assets/js/main.cab5088f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="Kotest" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Kotest</b></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-functions.html">Test Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-generators.html">Generators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-generators-list.html">Generators List</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/generator-operations.html">Generator Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-config.html">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/custom-generators.html">Custom Generators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/proptest/property-test-shrinking.html">Shrinking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-global-config.html">Global Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-generators-arrow.html">Arrow Generators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/kotlinx-datetime-gens.html">Kotlinx DateTime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proptest/property-test-extra-arbs.html">Extra Arbs</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Shrinking</h1></header><p>In property-based testing, the initially found failing case may contain a lot of complexity that does actually cause the test to fail.
Shrinking is the mechanism through which a property-based testing framework can simplify failing cases in order to find out the minimal reproducible case is.
In Kotest, the way in which failing cases from <a href="/docs/proptest/property-test-generators.html">generators</a> are shrunk is defined by implementations of the <code>Shrinker</code> interface.
Built-in generators generally have a default Shrinker defined by the framework, while custom generators can be given a custom Shrinker implementation.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="shrinking-for-built-in-generators">Shrinking for built-in generators<a aria-hidden="true" class="hash-link" href="#shrinking-for-built-in-generators" title="Direct link to heading">â€‹</a></h2><p>Built-in generators (see <a href="/docs/proptest/property-test-generators-list.html">Generators List</a>) have a default Shrinker defined by the framework.
A shrink function takes as input the value that failed the test and returns a list of new values on which Kotest can appy the test.
The exact behaviour depends on the data type.
For instance, a string could be shrunk by dropping the first or last character while for integers we could decrement or halve the value.
In addition, shrink behaviour is defined for edge cases such as an empty string or the integer 0.
The shrinking is performed when a test that uses such generator fails.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Arb.positiveInt().checkAll { i -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calculateProperty(i) shouldBe true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If the test fails for one of the generated inputs then the shrinking result is shown:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Property test failed for inputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0) 1792716902</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by io.kotest.assertions.AssertionFailedError: expected:&lt;1792716902&gt; but was:&lt;0&gt; at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invokeSuspend(PropertyBasedTest.kt:54)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invoke(PropertyBasedTest.kt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invoke(PropertyBasedTest.kt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io.kotest.property.internal.ProptestKt$proptest$3$2.invokeSuspend(proptest.kt:45)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attempting to shrink arg 1792716902</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #1: 1 pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #2: 597572300 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #3: 199190766 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #4: 66396922 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #5: 22132307 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #6: 7377435 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #7: 2459145 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #999: 29948 pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #1000: 44922 pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #1001: 59896 pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink #1002: 89839 fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shrink result (after 1002 shrinks) =&gt; 89839</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by io.kotest.assertions.AssertionFailedError: expected:&lt;89839&gt; but was:&lt;0&gt; at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invokeSuspend(PropertyBasedTest.kt:54)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invoke(PropertyBasedTest.kt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyBasedTest$1$1$3$1.invoke(PropertyBasedTest.kt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io.kotest.property.internal.ShrinkfnsKt$shrinkfn$1$1$smallestA$1.invokeSuspend(shrinkfns.kt:19)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By default, Kotest will shrink 1000 times. This behaviour is configurable.
For example, if you want to continue shrinking without bounds:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Arb.positiveInt().checkAll(PropTestConfig(shrinkingMode = ShrinkingMode.Unbounded)) { i -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calculateProperty(i) shouldBe true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="shrinking-for-custom-generators">Shrinking for custom generators<a aria-hidden="true" class="hash-link" href="#shrinking-for-custom-generators" title="Direct link to heading">â€‹</a></h2><p><a href="/docs/proptest/custom-generators.html">Custom generators</a> do not have a Shrinker defined by Kotest.
Instead, custom Shrinkers can be implemented.
Below is an example where the Shrinker returns coordinates that are next to the value itself.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">data class Coordinate(val x: Int, val y: Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CoordinateTest : FunSpec({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context(&quot;Coordinate Transformations&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Shrinker takes the four neighbouring coordinates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val coordinateShrinker = Shrinker&lt;Coordinate&gt; { c -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            listOf(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Coordinate(c.x - 1, c.y),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Coordinate(c.x, c.y - 1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Coordinate(c.x + 1, c.y),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Coordinate(c.x, c.y + 1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val coordinateArb = arbitrary(coordinateShrinker) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Coordinate(Arb.nonNegativeInt().bind(), Arb.nonNegativeInt().bind())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        test(&quot;Coordinates are always positive after transformation&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            coordinateArb.checkAll {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                transform(it).x shouldBeGreaterThanOrEqualTo 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                transform(it).y shouldBeGreaterThanOrEqualTo 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/proptest/shrinking.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/proptest/custom-generators.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Custom Generators</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/proptest/property-test-global-config.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Global Configuration<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#shrinking-for-built-in-generators" class="table-of-contents__link toc-highlight">Shrinking for built-in generators</a></li><li><a href="#shrinking-for-custom-generators" class="table-of-contents__link toc-highlight">Shrinking for custom generators</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Kotest Team. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0f6b8ab1.js"></script>
<script src="/assets/js/main.cab5088f.js"></script>
</body>
</html>